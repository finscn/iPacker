/**
 * MaxRectsBinPack 0.2.1
 * Copyright (c) 2017-present @06wj
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MaxRectsBinPack=t():e.MaxRectsBinPack=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(h){if(t[h])return t[h].exports;var n=t[h]={i:h,l:!1,exports:{}};return e[h].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,h){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:h})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(h,n,function(t){return e[t]}.bind(null,n));return h},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function h(e,t){for(var i=0;i<t.length;i++){var h=t[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(e,h.key,h)}}i.r(t);var n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i,this.width=h,this.height=n}var t,i,n;return t=e,n=[{key:"isContainedIn",value:function(e,t){return e.isContainedIn(t)}}],(i=[{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"isContainedIn",value:function(e){return this.x>=e.x&&this.y>=e.y&&this.x+this.width<=e.x+e.width&&this.y+this.height<=e.y+e.height}}])&&h(t.prototype,i),n&&h(t,n),e}();function a(e,t){for(var i=0;i<t.length;i++){var h=t[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(e,h.key,h)}}i.d(t,"Packer",function(){return d}),i.d(t,"ShortSideFit",function(){return r}),i.d(t,"LongSideFit",function(){return o}),i.d(t,"AreaFit",function(){return s}),i.d(t,"BottomLeft",function(){return u}),i.d(t,"ContactPoint",function(){return l});var r="ShortSideFit",o="LongSideFit",s="AreaFit",u="BottomLeft",l="ContactPoint",d=function(){function e(t,i,h){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,{allowRotate:!1,pot:!1,square:!1,padding:0}),this.usedRectangles=[],this.freeRectangles=[],this.init(t,i,h)}var t,i,h;return t=e,(i=[{key:"init",value:function(e,t,i){this.maxWidth=e,this.maxHeight=t,Object.assign(this,i),this.reset()}},{key:"reset",value:function(){this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new n(0,0,this.maxWidth,this.maxHeight))}},{key:"insert",value:function(e,t,i){var h=new n,a={value:0},d={value:0};switch(i=i||0,this.padding&&(e+=2*this.padding,t+=2*this.padding),i){case r:h=this._findPositionForNewNodeShortSideFit(e,t,a,d);break;case o:h=this._findPositionForNewNodeLongSideFit(e,t,d,a);break;case s:h=this._findPositionForNewNodeAreaFit(e,t,a,d);break;case u:h=this._findPositionForNewNodeBottomLeft(e,t,a,d);break;case l:h=this._findPositionForNewNodeContactPoint(e,t,a)}return 0===h.height?h:(this._placeRectangle(h),h)}},{key:"_cloneRectangles",value:function(e){var t=[];return e.forEach(function(e,i){t.push({x:e.x,y:e.y,width:e.width,height:e.height,_index:i})}),t}},{key:"insertRects",value:function(e,t){var i=this;if(!t){var h=[r,o,s,u,l],a=[];h.forEach(function(t,h){var n=i._cloneRectangles(e);i.reset();var r=i.insertRects(n,t);r._methodIndex=h,r.done&&a.push(r)}),a.sort(function(e,t){var i=0;return i=(i=(i=i||e.area-t.area)||e.binArea-t.binArea)||e.realArea-t.realArea});var d=a[0];return this.reset(),this.insertRects(e,h[d._methodIndex])}var c=-1,g=-1,f={rects:[],method:t,width:c,height:g,realWidth:c,realHeight:g,inputCount:e.length};if(this.padding)for(var v=0;v<f.inputCount;v++){var y=e[v];y.width+=2*this.padding,y.height+=2*this.padding}for(;e.length>0;){for(var w=1/0,x=1/0,p=-1,b=new n,m=0;m<e.length;m++){var M={value:0},_={value:0},k=this._scoreRectangle(e[m].width,e[m].height,t,M,_);(M.value<w||M.value===w&&_.value<x)&&(w=M.value,x=_.value,b=k,p=m)}if(-1===p)break;this._placeRectangle(b);var R=e.splice(p,1)[0];R.x=b.x,R.y=b.y,R.width===b.width&&R.height===b.height||(R.width=b.width,R.height=b.height,R.rotated=!0),c=Math.max(c,R.x+R.width),g=Math.max(g,R.y+R.height),f.rects.push(R)}var N=f.rects.length;if(f.packedCount=N,f.done=f.inputCount===N,this.padding)for(var F=0;F<N;F++){var P=f.rects[F];P.x+=this.padding,P.y+=this.padding,P.width-=2*this.padding,P.height-=2*this.padding}f.realWidth=c,f.realHeight=g,f.realArea=c*g;var S=Math.ceil(Math.log(c)/Math.log(2)),C=Math.ceil(Math.log(g)/Math.log(2));return f.binWidth=Math.pow(2,S),f.binHeight=Math.pow(2,C),f.binArea=f.binWidth*f.binHeight,this.pot?(f.width=f.binWidth,f.height=f.binHeight):(f.width=c,f.height=g),this.square&&(f.width=Math.max(f.width,f.height),f.height=Math.max(f.width,f.height)),f.area=f.width*f.height,f}},{key:"_placeRectangle",value:function(e){for(var t=this.freeRectangles.length,i=0;i<t;i++)this._splitFreeNode(this.freeRectangles[i],e)&&(this.freeRectangles.splice(i,1),i--,t--);this._pruneFreeList(),this.usedRectangles.push(e)}},{key:"_scoreRectangle",value:function(e,t,i,h,a){var d=new n;switch(h.value=1/0,a.value=1/0,i){case r:d=this._findPositionForNewNodeShortSideFit(e,t,h,a);break;case o:d=this._findPositionForNewNodeLongSideFit(e,t,a,h);break;case s:d=this._findPositionForNewNodeAreaFit(e,t,h,a);break;case u:d=this._findPositionForNewNodeBottomLeft(e,t,h,a);break;case l:d=this._findPositionForNewNodeContactPoint(e,t,h),h.value=-h.value}return 0===d.height&&(h.value=1/0,a.value=1/0),d}},{key:"_occupancy",value:function(){for(var e=this.usedRectangles,t=0,i=0;i<e.length;i++)t+=e[i].width*e[i].height;return t/(this.maxWidth*this.maxHeight)}},{key:"_findPositionForNewNodeShortSideFit",value:function(e,t,i,h){var a,r,o,s,u,l=this.freeRectangles,d=new n;i.value=1/0;for(var c=0;c<l.length;c++)(a=l[c]).width>=e&&a.height>=t&&(r=Math.abs(a.width-e),o=Math.abs(a.height-t),s=Math.min(r,o),u=Math.max(r,o),(s<i.value||s===i.value&&u<h.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=s,h.value=u)),this.allowRotate&&a.width>=t&&a.height>=e&&(r=Math.abs(a.width-t),o=Math.abs(a.height-e),s=Math.min(r,o),u=Math.max(r,o),(s<i.value||s===i.value&&u<h.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=s,h.value=u));return d}},{key:"_findPositionForNewNodeLongSideFit",value:function(e,t,i,h){var a,r,o,s,u,l=this.freeRectangles,d=new n;h.value=1/0;for(var c=0;c<l.length;c++)(a=l[c]).width>=e&&a.height>=t&&(r=Math.abs(a.width-e),o=Math.abs(a.height-t),s=Math.min(r,o),((u=Math.max(r,o))<h.value||u===h.value&&s<i.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=s,h.value=u)),this.allowRotate&&a.width>=t&&a.height>=e&&(r=Math.abs(a.width-t),o=Math.abs(a.height-e),s=Math.min(r,o),((u=Math.max(r,o))<h.value||u===h.value&&s<i.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=s,h.value=u));return d}},{key:"_findPositionForNewNodeAreaFit",value:function(e,t,i,h){var a,r,o,s,u,l=this.freeRectangles,d=new n;i.value=1/0;for(var c=0;c<l.length;c++)u=(a=l[c]).width*a.height-e*t,a.width>=e&&a.height>=t&&(r=Math.abs(a.width-e),o=Math.abs(a.height-t),s=Math.min(r,o),(u<i.value||u===i.value&&s<h.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,h.value=s,i=u)),this.allowRotate&&a.width>=t&&a.height>=e&&(r=Math.abs(a.width-t),o=Math.abs(a.height-e),s=Math.min(r,o),(u<i.value||u===i.value&&s<h.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,h.value=s,i.value=u));return d}},{key:"_findPositionForNewNodeBottomLeft",value:function(e,t,i,h){var a,r,o=this.freeRectangles,s=new n;i.value=1/0;for(var u=0;u<o.length;u++)(a=o[u]).width>=e&&a.height>=t&&((r=a.y+t)<i.value||r===i.value&&a.x<h.value)&&(s.x=a.x,s.y=a.y,s.width=e,s.height=t,i.value=r,h.value=a.x),this.allowRotate&&a.width>=t&&a.height>=e&&((r=a.y+e)<i.value||r===i.value&&a.x<h.value)&&(s.x=a.x,s.y=a.y,s.width=t,s.height=e,i.value=r,h.value=a.x);return s}},{key:"_findPositionForNewNodeContactPoint",value:function(e,t,i){var h,a,r=this.freeRectangles,o=new n;i.value=-1;for(var s=0;s<r.length;s++)(h=r[s]).width>=e&&h.height>=t&&(a=this._contactPointScoreNode(h.x,h.y,e,t))>i.value&&(o.x=h.x,o.y=h.y,o.width=e,o.height=t,i=a),this.allowRotate&&h.width>=t&&h.height>=e&&(a=this._contactPointScoreNode(h.x,h.y,t,e))>i.value&&(o.x=h.x,o.y=h.y,o.width=t,o.height=e,i.value=a);return o}},{key:"_commonIntervalLength",value:function(e,t,i,h){return t<i||h<e?0:Math.min(t,h)-Math.max(e,i)}},{key:"_contactPointScoreNode",value:function(e,t,i,h){var n,a=this.usedRectangles,r=0;0!==e&&e+i!==this.maxWidth||(r+=h),0!==t&&t+h!==this.maxHeight||(r+=i);for(var o=0;o<a.length;o++)(n=a[o]).x!==e+i&&n.x+n.width!==e||(r+=this._commonIntervalLength(n.y,n.y+n.height,t,t+h)),n.y!==t+h&&n.y+n.height!==t||(r+=this._commonIntervalLength(n.x,n.x+n.width,e,e+i));return r}},{key:"_splitFreeNode",value:function(e,t){var i,h=this.freeRectangles;return!(t.x>=e.x+e.width||t.x+t.width<=e.x||t.y>=e.y+e.height||t.y+t.height<=e.y)&&(t.x<e.x+e.width&&t.x+t.width>e.x&&(t.y>e.y&&t.y<e.y+e.height&&((i=e.clone()).height=t.y-i.y,h.push(i)),t.y+t.height<e.y+e.height&&((i=e.clone()).y=t.y+t.height,i.height=e.y+e.height-(t.y+t.height),h.push(i))),t.y<e.y+e.height&&t.y+t.height>e.y&&(t.x>e.x&&t.x<e.x+e.width&&((i=e.clone()).width=t.x-i.x,h.push(i)),t.x+t.width<e.x+e.width&&((i=e.clone()).x=t.x+t.width,i.width=e.x+e.width-(t.x+t.width),h.push(i))),!0)}},{key:"_pruneFreeList",value:function(){for(var e=this.freeRectangles,t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++){if(n.isContainedIn(e[t],e[i])){e.splice(t,1);break}n.isContainedIn(e[i],e[t])&&e.splice(i,1)}}}])&&a(t.prototype,i),h&&a(t,h),e}()}])});