/**
 * MaxRectsBinPack 0.2.1
 * Copyright (c) 2017-present @06wj
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MaxRectsBinPack=t():e.MaxRectsBinPack=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var h=t[n]={i:n,l:!1,exports:{}};return e[n].call(h.exports,h,h.exports,i),h.l=!0,h.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var h in e)i.d(n,h,function(t){return e[t]}.bind(null,h));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i,this.width=n,this.height=h}var t,i,h;return t=e,h=[{key:"isContainedIn",value:function(e,t){return e.isContainedIn(t)}}],(i=[{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"isContainedIn",value:function(e){return this.x>=e.x&&this.y>=e.y&&this.x+this.width<=e.x+e.width&&this.y+this.height<=e.y+e.height}}])&&n(t.prototype,i),h&&n(t,h),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,"Packer",function(){return d}),i.d(t,"ShortSideFit",function(){return r}),i.d(t,"LongSideFit",function(){return o}),i.d(t,"AreaFit",function(){return u}),i.d(t,"BottomLeft",function(){return s}),i.d(t,"ContactPoint",function(){return l});var r="ShortSideFit",o="LongSideFit",u="AreaFit",s="BottomLeft",l="ContactPoint",d=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,{allowRotate:!1,pot:!1,square:!1,padding:0}),this.usedRectangles=[],this.freeRectangles=[],this.init(t,i,n)}var t,i,n;return t=e,(i=[{key:"init",value:function(e,t,i){this.maxWidth=e,this.maxHeight=t,Object.assign(this,i),this.reset()}},{key:"reset",value:function(){this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new h(0,0,this.maxWidth,this.maxHeight))}},{key:"insert",value:function(e,t,i){var n=new h,a={value:0},d={value:0};switch(i=i||r,this.padding&&(e+=2*this.padding,t+=2*this.padding),i){case r:n=this._findPositionForNewNodeShortSideFit(e,t,a,d);break;case o:n=this._findPositionForNewNodeLongSideFit(e,t,d,a);break;case u:n=this._findPositionForNewNodeAreaFit(e,t,a,d);break;case s:n=this._findPositionForNewNodeBottomLeft(e,t,a,d);break;case l:n=this._findPositionForNewNodeContactPoint(e,t,a)}return 0===n.height?n:(this._placeRectangle(n),n)}},{key:"_cloneRectangles",value:function(e){var t=[];return e.forEach(function(e,i){t.push({x:e.x,y:e.y,width:e.width,height:e.height,_index:i})}),t}},{key:"insertRects",value:function(e,t){t||(t=this.getBestRule(e));var i=-1,n=-1,a={rects:[],rule:t,width:i,height:n,realWidth:i,realHeight:n,inputCount:e.length};if(this.padding)for(var r=0;r<a.inputCount;r++){var o=e[r];o.width+=2*this.padding,o.height+=2*this.padding}for(;e.length>0;){for(var u=1/0,s=1/0,l=-1,d=new h,c=0;c<e.length;c++){var g={value:0},f={value:0},v=this._scoreRectangle(e[c].width,e[c].height,t,g,f);(g.value<u||g.value===u&&f.value<s)&&(u=g.value,s=f.value,d=v,l=c)}if(-1===l)break;this._placeRectangle(d);var y=e.splice(l,1)[0],w={x:d.x,y:d.y,width:d.width,height:d.height};y.x=d.x,y.y=d.y,y.width===d.width&&y.height===d.height||(w.rotated=!0),i=Math.max(i,w.x+w.width),n=Math.max(n,w.y+w.height),y.packedInfo=w,a.rects.push(y)}var x=a.rects.length;if(a.packedCount=x,a.done=a.inputCount===x,this.padding)for(var p=0;p<x;p++){var b=a.rects[p];b.width-=2*this.padding,b.height-=2*this.padding;var m=b.packedInfo;m.x+=this.padding,m.y+=this.padding,m.width-=2*this.padding,m.height-=2*this.padding}a.realWidth=i,a.realHeight=n,a.realArea=i*n;var _=Math.ceil(Math.log(i)/Math.log(2)),M=Math.ceil(Math.log(n)/Math.log(2));return a.binWidth=Math.pow(2,_),a.binHeight=Math.pow(2,M),a.binArea=a.binWidth*a.binHeight,this.pot?(a.width=a.binWidth,a.height=a.binHeight):(a.width=i,a.height=n),a.area=a.width*a.height,a}},{key:"getBestRule",value:function(e){var t=this,i=[r,o,u,s,l],n=[];return i.forEach(function(i,h){var a=t._cloneRectangles(e);t.reset();var r=t.insertRects(a,i);r._ruleIndex=h,r.done&&n.push(r)}),this.reset(),n.sort(function(e,t){var i=0;return i=(i=(i=i||e.area-t.area)||e.binArea-t.binArea)||e.realArea-t.realArea}),i[n[0]._ruleIndex]}},{key:"_placeRectangle",value:function(e){for(var t=this.freeRectangles.length,i=0;i<t;i++)this._splitFreeNode(this.freeRectangles[i],e)&&(this.freeRectangles.splice(i,1),i--,t--);this._pruneFreeList(),this.usedRectangles.push(e)}},{key:"_scoreRectangle",value:function(e,t,i,n,a){var d=new h;switch(n.value=1/0,a.value=1/0,i){case r:d=this._findPositionForNewNodeShortSideFit(e,t,n,a);break;case o:d=this._findPositionForNewNodeLongSideFit(e,t,a,n);break;case u:d=this._findPositionForNewNodeAreaFit(e,t,n,a);break;case s:d=this._findPositionForNewNodeBottomLeft(e,t,n,a);break;case l:d=this._findPositionForNewNodeContactPoint(e,t,n),n.value=-n.value}return 0===d.height&&(n.value=1/0,a.value=1/0),d}},{key:"_occupancy",value:function(){for(var e=this.usedRectangles,t=0,i=0;i<e.length;i++)t+=e[i].width*e[i].height;return t/(this.maxWidth*this.maxHeight)}},{key:"_findPositionForNewNodeShortSideFit",value:function(e,t,i,n){var a,r,o,u,s,l=this.freeRectangles,d=new h;i.value=1/0;for(var c=0;c<l.length;c++)(a=l[c]).width>=e&&a.height>=t&&(r=Math.abs(a.width-e),o=Math.abs(a.height-t),u=Math.min(r,o),s=Math.max(r,o),(u<i.value||u===i.value&&s<n.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=u,n.value=s)),this.allowRotate&&a.width>=t&&a.height>=e&&(r=Math.abs(a.width-t),o=Math.abs(a.height-e),u=Math.min(r,o),s=Math.max(r,o),(u<i.value||u===i.value&&s<n.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=u,n.value=s));return d}},{key:"_findPositionForNewNodeLongSideFit",value:function(e,t,i,n){var a,r,o,u,s,l=this.freeRectangles,d=new h;n.value=1/0;for(var c=0;c<l.length;c++)(a=l[c]).width>=e&&a.height>=t&&(r=Math.abs(a.width-e),o=Math.abs(a.height-t),u=Math.min(r,o),((s=Math.max(r,o))<n.value||s===n.value&&u<i.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=u,n.value=s)),this.allowRotate&&a.width>=t&&a.height>=e&&(r=Math.abs(a.width-t),o=Math.abs(a.height-e),u=Math.min(r,o),((s=Math.max(r,o))<n.value||s===n.value&&u<i.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=u,n.value=s));return d}},{key:"_findPositionForNewNodeAreaFit",value:function(e,t,i,n){var a,r,o,u,s,l=this.freeRectangles,d=new h;i.value=1/0;for(var c=0;c<l.length;c++)s=(a=l[c]).width*a.height-e*t,a.width>=e&&a.height>=t&&(r=Math.abs(a.width-e),o=Math.abs(a.height-t),u=Math.min(r,o),(s<i.value||s===i.value&&u<n.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,n.value=u,i=s)),this.allowRotate&&a.width>=t&&a.height>=e&&(r=Math.abs(a.width-t),o=Math.abs(a.height-e),u=Math.min(r,o),(s<i.value||s===i.value&&u<n.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,n.value=u,i.value=s));return d}},{key:"_findPositionForNewNodeBottomLeft",value:function(e,t,i,n){var a,r,o=this.freeRectangles,u=new h;i.value=1/0;for(var s=0;s<o.length;s++)(a=o[s]).width>=e&&a.height>=t&&((r=a.y+t)<i.value||r===i.value&&a.x<n.value)&&(u.x=a.x,u.y=a.y,u.width=e,u.height=t,i.value=r,n.value=a.x),this.allowRotate&&a.width>=t&&a.height>=e&&((r=a.y+e)<i.value||r===i.value&&a.x<n.value)&&(u.x=a.x,u.y=a.y,u.width=t,u.height=e,i.value=r,n.value=a.x);return u}},{key:"_findPositionForNewNodeContactPoint",value:function(e,t,i){var n,a,r=this.freeRectangles,o=new h;i.value=-1;for(var u=0;u<r.length;u++)(n=r[u]).width>=e&&n.height>=t&&(a=this._contactPointScoreNode(n.x,n.y,e,t))>i.value&&(o.x=n.x,o.y=n.y,o.width=e,o.height=t,i=a),this.allowRotate&&n.width>=t&&n.height>=e&&(a=this._contactPointScoreNode(n.x,n.y,t,e))>i.value&&(o.x=n.x,o.y=n.y,o.width=t,o.height=e,i.value=a);return o}},{key:"_commonIntervalLength",value:function(e,t,i,n){return t<i||n<e?0:Math.min(t,n)-Math.max(e,i)}},{key:"_contactPointScoreNode",value:function(e,t,i,n){var h,a=this.usedRectangles,r=0;0!==e&&e+i!==this.maxWidth||(r+=n),0!==t&&t+n!==this.maxHeight||(r+=i);for(var o=0;o<a.length;o++)(h=a[o]).x!==e+i&&h.x+h.width!==e||(r+=this._commonIntervalLength(h.y,h.y+h.height,t,t+n)),h.y!==t+n&&h.y+h.height!==t||(r+=this._commonIntervalLength(h.x,h.x+h.width,e,e+i));return r}},{key:"_splitFreeNode",value:function(e,t){var i,n=this.freeRectangles,h=t.x>=e.x+e.width||t.x+t.width<=e.x,a=t.y>=e.y+e.height||t.y+t.height<=e.y;return!h&&!a&&(t.y>e.y&&((i=e.clone()).height=t.y-i.y,n.push(i)),t.y+t.height<e.y+e.height&&((i=e.clone()).y=t.y+t.height,i.height=e.y+e.height-(t.y+t.height),n.push(i)),t.x>e.x&&((i=e.clone()).width=t.x-i.x,n.push(i)),t.x+t.width<e.x+e.width&&((i=e.clone()).x=t.x+t.width,i.width=e.x+e.width-(t.x+t.width),n.push(i)),!0)}},{key:"_pruneFreeList",value:function(){for(var e=this.freeRectangles,t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++){if(h.isContainedIn(e[t],e[i])){e.splice(t,1);break}h.isContainedIn(e[i],e[t])&&e.splice(i,1)}}}])&&a(t.prototype,i),n&&a(t,n),e}()}])});